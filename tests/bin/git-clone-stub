#!/usr/bin/env bash
# Simplified git clone stub for offline verification. Copy or symlink this file to a
# location earlier in PATH (e.g. /usr/local/bin/git) before running the installer in
# environments where outbound HTTPS is blocked.
set -euo pipefail
if [[ ${1:-} == clone ]]; then
  dest="${@: -1}"
  rm -rf "$dest"
  mkdir -p "$dest/src"
  {
    printf 'all:\n'
    printf '\t@echo "[stub make] building pi_fm_rds"\n'
    printf '\t@printf '\''#!/usr/bin/env bash\\n'\'' > pi_fm_rds\n'
    printf '\t@printf '\''echo stub-pi_fm_rds exec\\\\n'\'' >> pi_fm_rds\n'
    printf '\t@chmod +x pi_fm_rds\n'
    printf 'clean:\n'
    printf '\t@rm -f pi_fm_rds\n'
  } >"$dest/src/Makefile"
  exit 0
fi
exec /usr/bin/git "$@"
